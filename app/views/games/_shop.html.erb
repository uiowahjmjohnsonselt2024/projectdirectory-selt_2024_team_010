<div class="game-shop">
  <!-- Main Tabs -->
  <div class="main-tabs">
    <button class="main-tablinks active" data-section="ShopSection">Shop</button>
    <button class="main-tablinks" data-section="ItemsSection">Items</button>
    <button class="main-tablinks" data-section="GameSection">Tile</button>
  </div>

  <!-- Shop Section -->
  <div id="ShopSection" class="main-tabcontent" style="display: block;">
    <div class="shop-container">
      <h2>In-Game Shop</h2>
      <div class="tab">
        <button class="tablinks active" data-category="Weapons">Weapons</button>
        <button class="tablinks" data-category="Armor">Armor</button>
        <button class="tablinks" data-category="Abilities">Abilities</button>
      </div>

      <!-- Weapons Tab Content -->
      <div id="Weapons" class="tabcontent" style="display: block;">
        <!-- Weapons Items List -->
      </div>

      <!-- Armor Tab Content -->
      <div id="Armor" class="tabcontent">
        <!-- Armor Items List -->
      </div>

      <!-- Abilities Tab Content -->
      <div id="Abilities" class="tabcontent">
        <!-- Abilities Items List -->
      </div>
    </div>

    <!-- Button to load AI-generated items -->
    <button id="load-items-button" style="margin-top:20px;">Load Items from AI</button>
  </div>

  <!-- Items Section -->
  <div id="ItemsSection" class="main-tabcontent">
    <!-- Items Content -->
    <h2>Your Items</h2>
    <p>Display your items here.</p>
  </div>

  <!-- Game Section -->
  <div id="GameSection" class="main-tabcontent">
    <!-- Game Content -->
    <h2> Tile </h2>
    <p>Display game-related content here.</p>
  </div>
</div>

<script>
    function initializeTabs() {
        // Main Tabs Logic
        const mainTabs = document.querySelectorAll(".main-tablinks");
        const mainTabContents = document.querySelectorAll(".main-tabcontent");

        mainTabs.forEach((tab) => {
            tab.addEventListener("click", (event) => {
                // Hide all main tab contents
                mainTabContents.forEach((content) => (content.style.display = "none"));

                // Remove active class from all main tabs
                mainTabs.forEach((t) => t.classList.remove("active"));

                // Show selected main tab content
                const sectionId = event.target.dataset.section;
                document.getElementById(sectionId).style.display = "block";

                event.target.classList.add("active");
            });
        });

        // Shop Tabs Logic
        const shopSection = document.getElementById("ShopSection");
        if (shopSection) {
            const shopTabs = shopSection.querySelectorAll(".tablinks");
            const shopTabContents = shopSection.querySelectorAll(".tabcontent");

            shopTabs.forEach((tab) => {
                tab.addEventListener("click", (event) => {
                    shopTabContents.forEach((content) => (content.style.display = "none"));

                    shopTabs.forEach((t) => t.classList.remove("active"));

                    const categoryId = event.target.dataset.category;
                    shopSection.querySelector(`#${categoryId}`).style.display = "block";

                    event.target.classList.add("active");
                });
            });


            const defaultShopTab = shopSection.querySelector(".tablinks.active");
            if (defaultShopTab) {
                defaultShopTab.click();
            } else if (shopTabs.length > 0) {
                shopTabs[0].click();
            }
        }


        const defaultMainTab = document.querySelector(".main-tablinks.active");
        if (defaultMainTab) {
            defaultMainTab.click();
        } else if (mainTabs.length > 0) {
            mainTabs[0].click();
        }

        initializeBuyButtons();
    }

    function initializeBuyButtons() {
        const buyButtons = document.querySelectorAll(".buy-button");
        buyButtons.forEach((button) => {
            button.addEventListener("click", (event) => {
                const itemDetails = event.target.closest(".item-details");
                const itemName = itemDetails.querySelector("h3").textContent;
                const itemPrice = itemDetails.querySelector("p:nth-child(3)").textContent;

                alert(`You have purchased ${itemName} for ${itemPrice}`);

            });
        });
    }

    async function loadItems() {
        const response = await fetch('/gameshop/generate_items.json');

        if (response.ok) {
            const data = await response.json();
            console.log(data)
            insertItemsIntoShop(data.items);
        } else {
            console.error("Failed to load items");
        }
    }

    function insertItemsIntoShop(items) {
        const weaponsContainer = document.getElementById("Weapons");
        const armorContainer = document.getElementById("Armor");
        const abilitiesContainer = document.getElementById("Abilities");

        [weaponsContainer, armorContainer, abilitiesContainer].forEach(container => {
            if (container) container.innerHTML = '';
        });

        items.forEach(item => {
            const itemDiv = document.createElement("div");
            itemDiv.classList.add("item-details");

            itemDiv.innerHTML = `
          <h3>${item.name}</h3>
          <p>${item.description}</p>
          <p>Price: ${item.price}</p>
          <p>Rarity: ${item.rarity}</p>
          <button class="buy-button">Buy</button>
        `;

            if (item.category === "Weapons" && weaponsContainer) {
                weaponsContainer.appendChild(itemDiv);
            } else if (item.category === "Armor" && armorContainer) {
                armorContainer.appendChild(itemDiv);
            } else if (item.category === "Abilities" && abilitiesContainer) {
                abilitiesContainer.appendChild(itemDiv);
            }
        });

        initializeBuyButtons();
    }

    document.addEventListener("DOMContentLoaded", () => {
        initializeTabs();
        const loadItemsButton = document.getElementById("load-items-button");
        if (loadItemsButton) {
            loadItemsButton.addEventListener("click", loadItems);
        }
    });


</script>
